# GoMT4 Documentation – Skeleton

> Version: v0 (starter scaffold). Goal: fill step‑by‑step with clear, beginner‑friendly explanations and runnable snippets.

---

## Table of Contents

* [Introduction](#introduction)
* [Setup & Environment](#setup--environment)
* [Architecture & Data Flow](#architecture--data-flow)
* [Reliability: Timeouts, Reconnects, Backoff](#reliability-timeouts-reconnects-backoff)
* [Troubleshooting & FAQ](#troubleshooting--faq)
* [Cookbook (Recipes)](#cookbook-recipes)

  * [Watchlist & Quotes](#watchlist--quotes)
  * [Place Order Safely](#place-order-safely)
  * [Compute PnL Correctly](#compute-pnl-correctly)
  * [Stream History to DB](#stream-history-to-db)
* [CLI Usage (Playground)](#cli-usage-playground)
* [API Reference (Types & Enums)](#api-reference-types--enums)
* [Performance Notes](#performance-notes)
* [Security & Secrets](#security--secrets)
* [Observability (Logs & Metrics)](#observability-logs--metrics)
* [Glossary (MT4 Terms)](#glossary-mt4-terms)

---

## Introduction

**What is GoMT4?**

* Short description of the project and its purpose.
* Who is it for: beginners, algo devs, ops.
* Quick links: Getting Started, CLI, Example app.

**Outcomes after reading:**

* Run a local demo.
* Connect to a terminal.
* Subscribe to quotes.
* Place/close an order in a safe way.

---

## Setup & Environment

**Goal:** Run everything on Windows with MT4 installed.

### Prerequisites

* Windows 10/11, MT4 Terminal installed.
* Go ≥ 1.21, protoc + gRPC plugins.
* VS Code (recommended) with Go extension.

### Install Steps (draft)

1. Install Go and protoc.
2. Clone repo and run `go mod tidy` in modules.
3. Configure MT4 terminal path and credentials via `.env`.
4. Open VS Code; provide `launch.json` for debugging.

---

## Architecture & Data Flow

**Goal:** Make the system non‑magical.

* Diagram: MT4 Terminal ⇄ gRPC server ⇄ Go client(s).
* Lifecycles: connect → use → disconnect.
* Streams: Quotes, Orders; channels and backpressure.
* Where retries/backoff happen.


---

## Reliability: Timeouts, Reconnects, Backoff

**Guidelines:**

* `context.WithTimeout` for unary calls (2–5s baseline).
* Treat `io.EOF` as transient on streams; reconnect with jitter (±250ms).
* Cancel path wiring: context cancellation closes goroutines.
* Avoid leaking streams; health checks.

**Code patterns:**

```go
// Pseudocode for unary with timeout
ctx, cancel := context.WithTimeout(parent, 3*time.Second)
defer cancel()
resp, err := client.Do(ctx, req)
// handle err
```

```go
// Stream reconnection loop (outline)
for attempt := 0; ; attempt++ {
  stream, err := client.Stream(ctx, req)
  if err != nil { backoff(attempt); continue }
  for {
    msg, err := stream.Recv()
    if err == io.EOF || isTransient(err) {
      backoff(attempt)
      break // reconnect
    }
    if err != nil { return err }
    handle(msg)
  }
}
```

---

## Troubleshooting & FAQ

* **“Symbol not found EURUSD”** → Broker suffix: try `EURUSD.m`.
* **“Invalid volume”** → Check `MinLot`/`LotStep` and round correctly.
* **“Digits mismatch”** → Use symbol `Digits` to format prices.
* **“No connection / timeouts”** → Firewall/UAC, terminal path, server ping.


---

## Cookbook (Recipes)

### Watchlist & Quotes

* Build a list of symbols; ensure visibility; poll or stream quotes.
* Example code block (to be filled with actual API calls).

### Place Order Safely

* Validate symbol trading mode; round volume/price; slippage; error handling.

### Compute PnL Correctly

* Use `TickValue`/`ContractSize`; convert to account currency if needed.

### Stream History to DB

* Paginate history; write batched inserts; idempotency tips.


---

## CLI Usage (Playground)

* Subscribe to quotes.
* Dump symbol params.
* Close orders by filter.

> TODO: list commands and flags + examples.

---

## API Reference (Types & Enums)

* Autogenerated types index with human‑readable notes.
* Units, ranges, and gotchas.

> TODO: link to proto docs and add field explanations.

---

## Performance Notes

* Batch calls where possible; avoid per‑tick RPCs.
* Expected latencies; simple load test plan.

---

## Security & Secrets

* `.env` handling, do not commit; Windows credential hints.
* Minimal terminal permissions.

---

## Observability (Logs & Metrics)

* Log format and levels.
* Basic metrics: latency, reconnects, dropped ticks.

---

## Glossary (MT4 Terms)

* Digits, Point, TickSize, TickValue, Lot, ContractSize.
* Hedging vs Netting (note if MT5 differences matter).


